---
title: "Zelizer (2019) Paper Replication and Extension"
author: "Miroslav Bergam"
date: "4/14/2020"
output: bookdown::pdf_document2
bibliography: bibliography.bib
link_citations: true
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

#### Load libraries
library(plyr)
library(stringr)
library(ggplot2)
library(boot)
library(tidyr)
library(grid)
library(RColorBrewer)
library(bookdown)
library(reshape2)
library(grid)
library(gridExtra)
library(data.table)
library(blockTools)
library(dplyr)
library(Hmisc)
library(gt)
library(rstanarm)

```

```{r Import Data}

load("Original-Data-and-Code/zelizer_replication_data_IPC.RData")

df$t <- relevel(as.factor(df$t) , ref = 2) ### Relevel factors so control is base category; Direct treatment: -1 is advocate; 0 is control; 1 is staffer
df$t.spill <- relevel(as.factor(df$t.spill) , ref = 2) ### Indirect treatment:  -1 is advocate; 0 is control; 1 is staffer; 2 is double staffer
for(i in 1:ncol(t.for.ri)){
  t.for.ri[,i] <- relevel(as.factor(t.for.ri[,i]) , ref = 2)
  t.spill.for.ri[,i] <- relevel(as.factor(t.spill.for.ri[,i]) , ref = 2)
  #cat("\r", i, "of", ncol(t.for.ri)) ### How far loop has progressed
}
df$treatment <- interaction(df$t,df$t.spill)
#levels(t.for.ri[,1])
#levels(t.spill.for.ri[,1])
#levels(df$treatment)

```

## Abstract

Zelizer (2019) finds that the cues that legislators take from their peers, in
addition to other credible sources of information like briefings, influence
their policymaking decisions. I succesfully replicated Zelizer’s results. This
extension not only Zelizer took a Bayesian approach to his findings, running a
large number of simulations for each table using for-loops to produce estimates
and standard deviations; however, this made his code inefficient and slow. I
used the rstanarm package to simplify his code and match the results as a
robustness check. Finally, I graphed the posterior predictive distributions to
analyze overall a Bayesian approach to this study. This extension served as both
a robustness test of Zelizer's results and a simplification that makes the
coefficient estimates more easily reproducable.


## Introduction

The first paragraph is a review of the paper you are replicating. Flesh out the details. Tell us about the data and the model. Place it within the relevant literature, via a key citation or two. Highlight implications and caveats. Again, it is hard to summarize a 25 page paper in a paragraph. Do your best. Note that the paper’s own abstract is often a useful guide.

The second paragraph provides more details on your replications. Mention that you used R, and provide an citation to R in your bibliography. (See citation().) Cite the location from which you got the data and code for your replication. (This might be to the Dataverse, a webpage or “personal communication” with the author.) Provide a footnote with a link to your repo.

The third and fourth paragraphs are more flexible. Indeed, they might be only one paragraph or they might be several. What did you do? What did you find?

The final paragraph is different between the introduction and the conclusion. In the introduction, it may not even exist! (We don’t want to be overly didactic here. There are many ways to write a great paper.) Or it may just provide a roadmap to the rest of the paper. In the conclusion, the last paragraph is where you get to speculate: What does it all mean? What should we research next?

## Literature Review

Studies as early as Matthews and Stimson (1975) and Kingdon (1973) find that
cue-taking has a large influence on the decisions made by policy-makers. Kingdon
concluded that cue-taking influences around 40% of decisions while Matthews and
Stimson pinned the number around 75%. More recent observational studies like Masket
(2008) found the percentage of votes influenced by cue-taking to be 10%. Masket
found that information was shared primarily through deskmates, while Matthews
and Stimson found that it was shared between friends. Coppock (2014) found that
information was shared between ideologically-similar legislators. 

This paper abets the conclusion that cue-taking influences policy decisions
while updating the approach and contributing a new layer of findings. It uses a
large dataset from two legislative field experiments, lending it power that
previous studies may have lacked, and focuses on legislators who share office
suites. The paper contributes the findings that that cues complement complement
rather than substitute other sources of expertise as well as that cue-making's
influence occurs late in the decision-making process.

## Replication

I was able to match all of the coefficient estimates from the original paper in
my replicated figures. Zelizer gathers his Bayesian estimates using for-loops
with thousands of iterations. His original code took a large amount of time to
replicate on my own computer, so I used tools like stan_lm() from the rstanarm()
package to maintain the Bayesian integrity of the study while greatly minimizing
the computational power needed.

However, a clear downside to my approach are my inaccurate standard errors. I
was able to replicate every standard error when using Zelizer's code, but my
method didn't account for certian intricacies in the data. In one of the two
studies captured in the data, legislators were not eligable for briefings from
the staffer/advocate. This leads to implicit clustering in the data of those who
were not briefed (one of the treatment variables). As a result, the standard
errors produced by my Bayesian stan_lm models are too small because it assumes
that all participants in the study receieved a briefing and that therefore is a
large population of legislators (from that study) who by default have no
variability in this briefing treatment.

Therefore, while I am able to replicate the standard errors using the original
replication code, the method used in this paper produces overly narrow standard
errors that don't take into consideration implicit clustering. Zelizer's more
accurate method works arounnd this issue using a particular form of
Randomization Inference.

## Extension

## Conclusion

^[[All analysis for this paper is availible at https://github.com/mirobergam/Replication-paper](https://github.com/mirobergam/Replication-paper)]


## Figures 
### Table 3

```{r Table 3}

### Table 3:
table3 <- subset(df , office.size > 1) %>%
  ddply(. , .(treatment) , function(x) out = data.frame(
    Weighted.Mean = round(weighted.mean(x$cosp , x$ipw),3) ,
    N = length(x$cosp))) %>%
  mutate(treatment = as.integer(treatment)) %>%
  filter(treatment == 1 | treatment == 3 | treatment == 7 | treatment == 9)

treatments3 <- tibble(treatment = c(1,3,7,9),
                      `Cue-Taking` = c("NO CUE-TAKING", "NO CUE-TAKING", 
                                       "YES CUE-TAKING", "YES CUE-TAKING"),
                      Briefing = c("NO", "YES", "NO", "YES"))

table3 <- treatments3 %>% left_join(table3, by = "treatment") %>%
  mutate(Weighted.Mean = Weighted.Mean * 100) %>%
  mutate(Weighted.Mean = as.character(Weighted.Mean)) %>%
  mutate(N = as.character(N)) %>%
  mutate(`Mean(N)` = paste(Weighted.Mean," (", N, ")")) %>%
  select(`Cue-Taking`, Briefing, `Mean(N)`)  %>%
  pivot_wider(names_from = `Cue-Taking`, values_from = `Mean(N)`)

gt(table3) %>% 
  tab_header(
    title = "Table 3",
    subtitle = "Summary of Cosponsorship by Briefing and Cue-Taking Assignment (in pp)"
  )

```

### Table 4

```{r}

## pp_check(model, "dens_overlay") # takes the original data and show in a really dark apttern, and show the bayesian runs of it in the background to see how well the data ftis
# weird fit
# because these are discrete values the model ended up matching up weird but its decent. bayesian model assu,es conntinues. <ike for example the tail extends past 0. try to make it discrete instead of continiuous

x <- stan_lm(cosp ~ treatment + bill + leg, data = subset(df , office.size > 1), weights=ipw, refresh = FALSE, prior = NULL)

#summary(x, digits = 10)

x_coef <- x$coefficients[c('treatment1.0','treatment0.1','treatment1.1')]
x_ses <- x$ses[c('treatment1.0','treatment0.1','treatment1.1')]

x_final <- rbind(x_coef, x_ses)
x_final <- as_tibble(x_final)

x_final <- x_final %>%
  mutate(Combined = round(`treatment1.1` * 100, 2),
         Briefing = round(`treatment1.0` * 100, 2),
         `Cue-Taking` = round(`treatment0.1` * 100, 2),
         Value = c("ITT", "SE")) %>%
  select(Value, Briefing, `Cue-Taking`, Combined)

gt(x_final) %>% 
  tab_header(
    title = "Table 4",
    subtitle = "Estimated Briefing and Cue-Taking Effects (in pp)"
  )

```

### Table 5

```{r Table 5}

y1 <- stan_lm(cosp ~ treatment + bill + leg, data = subset(df , office.size > 1 & passed==0), weights=ipw, refresh = FALSE, prior = NULL)

y2 <- stan_lm(cosp ~ treatment + bill + leg, data = subset(df , office.size > 1 & passed==1), weights=ipw, refresh = FALSE, prior = NULL)

#summary(x, digits = 10)

y1_coef <- y1$coefficients[c('treatment1.0','treatment0.1','treatment1.1')]
y1_ses <- y1$ses[c('treatment1.0','treatment0.1','treatment1.1')]
y2_coef <- y2$coefficients[c('treatment1.0','treatment0.1','treatment1.1')]
y2_ses <- y2$ses[c('treatment1.0','treatment0.1','treatment1.1')]

y_final <- rbind(y1_coef, y1_ses, y2_coef, y2_ses)
y_final <- as_tibble(y_final)

y_final <- y_final %>%
  mutate(Combined = round(`treatment1.1` * 100, 2),
         Briefing = round(`treatment1.0` * 100, 2),
         `Cue-Taking` = round(`treatment0.1` * 100, 2),
         Value = c("ITT", "SE", "ITT", "SE"),
         `Reached Floor?` = c("Bills that failed in committee",
                              "",
                              "Bills that reached floor",
                              "")) %>%
  select(`Reached Floor?`, Value, Briefing, `Cue-Taking`, Combined)

gt(y_final) %>% 
  tab_header(
    title = "Table 5",
    subtitle = "Estimated Briefing and Cue-Taking Effects by Bill Progress (in pp)"
  )


```

### Table 6

```{r}

set.seed(1006)

z1 <- stan_lm(cosp ~ treatment + bill + leg, 
   data = subset(df , office.size > 1 & 
                   !is.na(t.spill.desk) &
                   !is.na(t.spill.dist) &
                   !is.na(t.spill.ideo)),
   weights=ipw, refresh = FALSE, prior = NULL)

z2 <- stan_lm(cosp ~ treatment.desk + bill + leg,
   data = subset(df , office.size > 1 &
                   !is.na(t.spill.desk) &
                   !is.na(t.spill.dist) &
                   !is.na(t.spill.ideo)),
   weights=ipw.desk, refresh = FALSE, prior = NULL)

z3 <- stan_lm(cosp ~ treatment.dist + bill + leg,
   data = subset(df , office.size > 1 &
                   !is.na(t.spill.desk) &
                   !is.na(t.spill.dist) &
                   !is.na(t.spill.ideo)),
   weights=ipw.desk, refresh = FALSE, prior = NULL)

z4 <- stan_lm(cosp ~ treatment.ideo + bill + leg,
         data = subset(df , office.size > 1 &
                         !is.na(t.spill.desk) &
                         !is.na(t.spill.dist) &
                         !is.na(t.spill.ideo)),
         weights=ipw.ideo, refresh = FALSE, prior = NULL)

z1_coef <- z1$coefficients[c('treatment1.0','treatment0.1','treatment1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z1_ses <- z1$ses[c('treatment1.0','treatment0.1','treatment1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z2_coef <- z2$coefficients[c('treatment.desk1.0','treatment.desk0.1','treatment.desk1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z2_ses <- z2$ses[c('treatment.desk1.0','treatment.desk0.1','treatment.desk1.1')]%>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z3_coef <- z3$coefficients[c('treatment.dist1.0','treatment.dist0.1','treatment.dist1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z3_ses <- z3$ses[c('treatment.dist1.0','treatment.dist0.1','treatment.dist1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z4_coef <- z4$coefficients[c('treatment.ideo1.0','treatment.ideo0.1','treatment.ideo1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z4_ses <- z4$ses[c('treatment.ideo1.0','treatment.ideo0.1','treatment.ideo1.1')] %>% as_tibble() %>% mutate(value = value * 100) %>% round(2)

z_final <- z1_coef %>%
  mutate(`Model (SE)` = c("Briefing", "Cue-Taking", "Combined"),
        `Offices` = as.character(z1_coef$value),
        `Office SE`= as.character(z1_ses$value),
        `Office (SE)` = paste(`Offices`," (", `Office SE`, ")"),
        `Desks`= as.character(z2_coef$value),
        `Desks SE`= as.character(z2_ses$value),
        `Desks (SE)` = paste(`Desks`," (", `Desks SE`, ")"),
        `Districts`= z3_coef$value,
        `Districts SE`= z3_ses$value,
        `Districts (SE)` = paste(`Districts`," (", `Districts SE`, ")"),
        `Ideology`= z4_coef$value,
        `Ideology SE`= z4_ses$value,
        `Ideology (SE)` = paste(`Ideology`," (", `Ideology SE`, ")")) %>%
  select(`Model (SE)`, `Office (SE)`, `Desks (SE)`, `Districts (SE)`, `Ideology (SE)`)

gt(z_final) %>%
  tab_header(
    title = "Table 6",
    subtitle = "Estimated Briefing and Cue-Taking Effects Under Alternate Spillover Models (in pp)"
  )

```


```{r Table 6, cache = TRUE}

### This function creates simulation-based inverse probability weights.
ipw.function <- function(DATASET , T , T.SPILL , RI.T , RI.T.SPILL , VARNAME){
	temp <- apply(matrix(1:ncol(RI.T.SPILL) , nrow=1) , 2 , function(z) {
		temp1 <- as.numeric(RI.T.SPILL[,z]==DATASET[,T.SPILL])
		temp2 <- as.numeric(RI.T[,z]==DATASET[,T])
		return(as.numeric(temp1+temp2==2))
	})

	DATASET$V1 <- 1/apply(temp , 1 , mean)
	setnames(DATASET,"V1",VARNAME)
	return(DATASET)
}

load("Original-Data-and-Code/replication_data_alternative_spillover_simulations.RData")
### Add IPWs for observed assignments
df <- ipw.function(df , "t" , "t.spill.desk" , t.for.ri , ri.t.spill.desk , "ipw.desk")
df <- ipw.function(df , "t" , "t.spill.dist" , t.for.ri , ri.t.spill.dist , "ipw.dist")
df <- ipw.function(df , "t" , "t.spill.ideo" , t.for.ri , ri.t.spill.ideo , "ipw.ideo")

table(df$t.spill,useNA="always")
table(df$t.spill.desk,useNA="always")
table(df$t.spill.dist,useNA="always")
table(df$t.spill.ideo,useNA="always")

df$treatment.desk <- relevel(interaction(df$t,df$t.spill.desk) , ref = 4)
df$treatment.dist <- relevel(interaction(df$t,df$t.spill.dist) , ref = 4)
df$treatment.ideo <- relevel(interaction(df$t,df$t.spill.ideo) , ref = 4)

estimates <- data.frame(itt = matrix(NA,nrow=3,ncol=4))
row.names(estimates) <- c("t","t.spill","t+t.spill")
colnames(estimates) <- c("office","desk","distance","ideology")

### Office Spillover
estimates[1:3,1] <- unlist( summary(lm(cosp ~ treatment + bill + leg,
                      data = subset(df , office.size > 1 &
                                      !is.na(t.spill.desk) &
                                      !is.na(t.spill.dist) &
                                      !is.na(t.spill.ideo)),
                      weights=ipw))$coef[c('treatment1.0',
                                           'treatment0.1',
                                           'treatment1.1'),
                                           'Estimate'] )

### Desk Spillover
estimates[1:3,2] <- unlist( summary(lm(cosp ~ treatment.desk + bill + leg,
                      data = subset(df , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw.desk))$coef[c('treatment.desk1.0',
                                                'treatment.desk0.1',
                                                'treatment.desk1.1'),
                                                'Estimate'] )

 ### Distance Spillover
estimates[1:3,3] <- unlist( summary(lm(cosp ~ treatment.dist + bill + leg,
                      data = subset(df , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw.dist))$coef[c('treatment.dist1.0',
                                                'treatment.dist0.1',
                                                'treatment.dist1.1'),
                                                'Estimate'] )

### Ideology Spillover
estimates[1:3,4] <- unlist( summary(lm(cosp ~ treatment.ideo + bill + leg,
                      data = subset(df , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw.ideo))$coef[c('treatment.ideo1.0',
                                                'treatment.ideo0.1',
                                                'treatment.ideo1.1'),
                                                'Estimate'] )

#######################               RI           ##########################

ri.t2 <- array(NA, dim = c(3 , 4, 50), #originally ncol(ri.t.spill.desk)
               dimnames = list(
                 c("t","t.spill","t+t.spill"),
                 c("office","desk","distance","ideology"),
                 c(1:50)))

for(i in 1:25){ #ncol(ri.t.spill.desk)
  tempdf <- df[,c("bill","cosp","office.size","leg")]
  tempdf$t <- t.for.ri[,i]
  tempdf$t.spill <- t.spill.for.ri[,i]
  tempdf$ipw <- ipw.for.ri[,i]

  tempdf$t.spill.desk <- ri.t.spill.desk[,i]
  tempdf$t.spill.dist <- ri.t.spill.dist[,i]
  tempdf$t.spill.ideo <- ri.t.spill.ideo[,i]


  tempdf <- ipw.function(tempdf , "t" , "t.spill.desk" , t.for.ri , ri.t.spill.desk , "ipw.desk")
  tempdf <- ipw.function(tempdf , "t" , "t.spill.dist" , t.for.ri , ri.t.spill.dist , "ipw.dist")
  tempdf <- ipw.function(tempdf , "t" , "t.spill.ideo" , t.for.ri , ri.t.spill.ideo , "ipw.ideo")
  tempdf$treatment <- interaction(tempdf$t,tempdf$t.spill)
  tempdf$treatment.desk <- interaction(tempdf$t,tempdf$t.spill.desk)
  tempdf$treatment.dist <- interaction(tempdf$t,tempdf$t.spill.dist)
  tempdf$treatment.ideo <- interaction(tempdf$t,tempdf$t.spill.ideo)
  #print(levels(tempdf$treatment.ideo)[1])
  #print(levels(tempdf$treatment.desk)[1])
  #print(levels(tempdf$treatment.dist)[1])

  ### Office Spillover
  ri.t2[1:3,1,i] <- unlist( summary(lm(cosp ~ treatment + bill + leg,
                      data = subset(tempdf , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw))$coef[c('treatment1.0',
                                           'treatment0.1',
                                           'treatment1.1'),
                                           'Estimate'] )

  ### Desk Spillover
  ri.t2[1:3,2,i] <- unlist( summary(lm(cosp ~ treatment.desk + bill + leg,
                      data = subset(tempdf , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw.desk))$coef[c('treatment.desk1.0',
                                                'treatment.desk0.1',
                                                'treatment.desk1.1'),'Estimate'] )

  ### Distance Spillover
  ri.t2[1:3,3,i] <- unlist( summary(lm(cosp ~ treatment.dist + bill + leg,
                      data = subset(tempdf , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw.dist))$coef[c('treatment.dist1.0',
                                                'treatment.dist0.1',
                                                'treatment.dist1.1'),
                                                'Estimate'] )

  ### Ideology Spillover
  ri.t2[1:3,4,i] <- unlist( summary(lm(cosp ~ treatment.ideo + bill + leg,
                      data = subset(tempdf , office.size > 1 &
                                     !is.na(t.spill.desk) &
                                     !is.na(t.spill.dist) &
                                     !is.na(t.spill.ideo)),
                      weights=ipw.ideo))$coef[c('treatment.ideo1.0',
                                                'treatment.ideo0.1',
                                                'treatment.ideo1.1'),
                                                'Estimate'] )

  #cat("\r", i, "of", ncol(ri.t.spill.desk)) ### How far loop has progressed
}

### Table 6:
for(j in 1:4){
  print(colnames(estimates)[j])
  for(i in 1:3){
  print(row.names(estimates)[i])
  assign(paste0("owl", i * (j+6)), 
  data.frame(
  	 st = estimates[i,j] ,
  	SD = sd(ri.t2[i,j,])
  ))
  }}

table6 <- rbind(owl7, owl8, owl9, owl10, owl14, owl16,
                owl18, owl20, owl21, owl24, owl27, owl30) %>%
  mutate(Condition = c("Briefing","Briefing","Briefing","Briefing",
                       "Cue-Taking","Cue-Taking","Cue-Taking","Cue-Taking",
                       "Combined", "Combined", "Combined", "Combined"),
         Model = c("Offices", "Desks", "Districts", "Ideology",
                   "Offices", "Desks", "Districts", "Ideology",
                   "Offices", "Desks", "Districts", "Ideology"),
         ITT = round((st * 100),3),
         SE = round((SD * 100),3)) %>%
  select(Model, Condition, ITT, SE)

table61 <- table6 %>%
  mutate(ITT = as.character(ITT)) %>%
  mutate(SE = as.character(SE)) %>%
  mutate(`ITT(SE)` = paste(ITT," (", SE, ")")) %>%
  select(Model, Condition, `ITT(SE)`)  %>%
  pivot_wider(names_from = Model, values_from = `ITT(SE)`)

gt(table61)

```


### Figure 3

```{r}

load("Original-Data-and-Code/zelizer_replication_data_dates_IPC.RData")

nsims <- 10 #This was at 1000 before

df$treatment <- interaction(df$t,df$t.spill)
levels(df$treatment)

nDays <- seq(0,98,7)
days.ri <- data.frame(matrix(NA,nrow=length(nDays) , ncol = 3))
days.ri.SE <- data.frame(matrix(NA,nrow=length(nDays) , ncol = 3))

for(i in nDays){
  Ydays <- as.numeric(!is.na(df$days) & df$days <= i & df$days >=0 & df$cosp==1)
  days.ri[match(i,nDays),1:3] <- summary(lm(Ydays ~ treatment + bill + leg ,
                                            data = df,
                                            weights=ipw))$coef[c('treatment1.0','treatment0.1','treatment1.1'),'Estimate']
  temp <- data.frame(matrix(NA,nrow=nsims,ncol=3))
  for(j in 1:nsims){
    treatment.sim <- interaction(t.for.ri2[,j],t.spill.for.ri2[,j])
    levels(treatment.sim)
    temp[j,1:3] <- summary(lm(Ydays ~ treatment.sim + bill + leg ,
                              data = df,
                              weights=ipw.for.ri2[,j]))$coef[c('treatment.sim1.0','treatment.sim0.1','treatment.sim1.1'),'Estimate']
  }
  temp <- apply(temp , 2 , sd)
  days.ri.SE[match(i,nDays),1:3] <- temp
  cat("\r", i, "of", nDays) ### How far loop has progressed
}

tempnum <- 1
data.frame(ATE = days.ri[,tempnum],
           CIlow = days.ri[,tempnum] - 1.65*days.ri.SE[,tempnum],
           CIhigh = days.ri[,tempnum] + 1.65*days.ri.SE[,tempnum],
           X = nDays/7) %>%
  ggplot(., aes(x = factor(X) )) +
  geom_errorbar(aes(ymin = CIlow*100 , ymax = CIhigh*100 , width = 0)) +
  geom_point(aes(y = ATE*100)) +
  scale_y_continuous(minor_breaks=waiver(), labels = waiver(), breaks=c(-2,0,2,4,6,8) , limits = c(-2,9)) +
  labs(x = "Week of Session", y = "Est. ATE (perc. pts.)") +
  geom_smooth(aes(y = ATE*100) , col = "black" , method = "loess" , se = FALSE) +
  geom_vline(xintercept=0 , color = "#535353" , lwd = 1) +
  geom_hline(yintercept=0 , color = "#535353" , lwd = 1) +
  theme(panel.background = element_blank(),
        panel.grid = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_text(color = "#535353" , size = 12, face="bold"),
        axis.title.y = element_text(color = "#535353" , size = 12, face="bold"),
        axis.text.y = element_text(size = 12, colour = "grey50"),
        axis.text.x = element_text(size = 8, colour = "grey50"),
        panel.border = element_blank(),
        legend.key = element_rect(colour = "white",fill = "white"),
        legend.text = element_text(size=10,color="grey50"),
        legend.title = element_text(size = 11, face = "bold", colour = "#535353"),
        strip.text.x = element_text(size = 11, face = "bold", colour = "#535353"),
        strip.background = element_rect(colour = "white", fill = "white"),
        legend.position="right",
        plot.margin = unit(c(0.75,0.75,0.75,0.75), "cm"))


```

### Figure 4

```{r}

tempnum <- 2
data.frame(ATE = days.ri[,tempnum],
           CIlow = days.ri[,tempnum] - 1.65*days.ri.SE[,tempnum],
           CIhigh = days.ri[,tempnum] + 1.65*days.ri.SE[,tempnum],
           X = nDays/7) %>%
  ggplot(., aes(x = factor(X) )) +
  geom_errorbar(aes(ymin = CIlow*100 , ymax = CIhigh*100 , width = 0)) +
  geom_point(aes(y = ATE*100)) +
  scale_y_continuous(minor_breaks=waiver(), labels = waiver(), breaks=c(-2,0,2,4,6,8) , limits = c(-2,9)) +
  labs(x = "Week of Session", y = "Est. ATE (perc. pts.)") +
  geom_smooth(aes(y = ATE*100) , col = "black" , method = "loess" , se = FALSE) +
  geom_vline(xintercept=0 , color = "#535353" , lwd = 1) +
  geom_hline(yintercept=0 , color = "#535353" , lwd = 1) +
  theme(panel.background = element_blank(),
        panel.grid = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_text(color = "#535353" , size = 12, face="bold"),
        axis.title.y = element_text(color = "#535353" , size = 12, face="bold"),
        axis.text.y = element_text(size = 12, colour = "grey50"),
        axis.text.x = element_text(size = 8, colour = "grey50"),
        panel.border = element_blank(),
        legend.key = element_rect(colour = "white",fill = "white"),
        legend.text = element_text(size=10,color="grey50"),
        legend.title = element_text(size = 11, face = "bold", colour = "#535353"),
        strip.text.x = element_text(size = 11, face = "bold", colour = "#535353"),
        strip.background = element_rect(colour = "white", fill = "white"),
        legend.position="right",
        plot.margin = unit(c(0.75,0.75,0.75,0.75), "cm"))

```

### Bibliography

@main_paper @side_paper_1 @side_paper_2 @side_paper_3 @side_paper_4
